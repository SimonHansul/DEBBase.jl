<!DOCTYPE html>
<html>
<head>
<title>manuscript.md</title>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8">

<style>
/* https://github.com/microsoft/vscode/blob/master/extensions/markdown-language-features/media/markdown.css */
/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

body {
	font-family: var(--vscode-markdown-font-family, -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif);
	font-size: var(--vscode-markdown-font-size, 14px);
	padding: 0 26px;
	line-height: var(--vscode-markdown-line-height, 22px);
	word-wrap: break-word;
}

#code-csp-warning {
	position: fixed;
	top: 0;
	right: 0;
	color: white;
	margin: 16px;
	text-align: center;
	font-size: 12px;
	font-family: sans-serif;
	background-color:#444444;
	cursor: pointer;
	padding: 6px;
	box-shadow: 1px 1px 1px rgba(0,0,0,.25);
}

#code-csp-warning:hover {
	text-decoration: none;
	background-color:#007acc;
	box-shadow: 2px 2px 2px rgba(0,0,0,.25);
}

body.scrollBeyondLastLine {
	margin-bottom: calc(100vh - 22px);
}

body.showEditorSelection .code-line {
	position: relative;
}

body.showEditorSelection .code-active-line:before,
body.showEditorSelection .code-line:hover:before {
	content: "";
	display: block;
	position: absolute;
	top: 0;
	left: -12px;
	height: 100%;
}

body.showEditorSelection li.code-active-line:before,
body.showEditorSelection li.code-line:hover:before {
	left: -30px;
}

.vscode-light.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(0, 0, 0, 0.15);
}

.vscode-light.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(0, 0, 0, 0.40);
}

.vscode-light.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-dark.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 255, 255, 0.4);
}

.vscode-dark.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 255, 255, 0.60);
}

.vscode-dark.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

.vscode-high-contrast.showEditorSelection .code-active-line:before {
	border-left: 3px solid rgba(255, 160, 0, 0.7);
}

.vscode-high-contrast.showEditorSelection .code-line:hover:before {
	border-left: 3px solid rgba(255, 160, 0, 1);
}

.vscode-high-contrast.showEditorSelection .code-line .code-line:hover:before {
	border-left: none;
}

img {
	max-width: 100%;
	max-height: 100%;
}

a {
	text-decoration: none;
}

a:hover {
	text-decoration: underline;
}

a:focus,
input:focus,
select:focus,
textarea:focus {
	outline: 1px solid -webkit-focus-ring-color;
	outline-offset: -1px;
}

hr {
	border: 0;
	height: 2px;
	border-bottom: 2px solid;
}

h1 {
	padding-bottom: 0.3em;
	line-height: 1.2;
	border-bottom-width: 1px;
	border-bottom-style: solid;
}

h1, h2, h3 {
	font-weight: normal;
}

table {
	border-collapse: collapse;
}

table > thead > tr > th {
	text-align: left;
	border-bottom: 1px solid;
}

table > thead > tr > th,
table > thead > tr > td,
table > tbody > tr > th,
table > tbody > tr > td {
	padding: 5px 10px;
}

table > tbody > tr + tr > td {
	border-top: 1px solid;
}

blockquote {
	margin: 0 7px 0 5px;
	padding: 0 16px 0 10px;
	border-left-width: 5px;
	border-left-style: solid;
}

code {
	font-family: Menlo, Monaco, Consolas, "Droid Sans Mono", "Courier New", monospace, "Droid Sans Fallback";
	font-size: 1em;
	line-height: 1.357em;
}

body.wordWrap pre {
	white-space: pre-wrap;
}

pre:not(.hljs),
pre.hljs code > div {
	padding: 16px;
	border-radius: 3px;
	overflow: auto;
}

pre code {
	color: var(--vscode-editor-foreground);
	tab-size: 4;
}

/** Theming */

.vscode-light pre {
	background-color: rgba(220, 220, 220, 0.4);
}

.vscode-dark pre {
	background-color: rgba(10, 10, 10, 0.4);
}

.vscode-high-contrast pre {
	background-color: rgb(0, 0, 0);
}

.vscode-high-contrast h1 {
	border-color: rgb(0, 0, 0);
}

.vscode-light table > thead > tr > th {
	border-color: rgba(0, 0, 0, 0.69);
}

.vscode-dark table > thead > tr > th {
	border-color: rgba(255, 255, 255, 0.69);
}

.vscode-light h1,
.vscode-light hr,
.vscode-light table > tbody > tr + tr > td {
	border-color: rgba(0, 0, 0, 0.18);
}

.vscode-dark h1,
.vscode-dark hr,
.vscode-dark table > tbody > tr + tr > td {
	border-color: rgba(255, 255, 255, 0.18);
}

</style>

<style>
/* Tomorrow Theme */
/* http://jmblog.github.com/color-themes-for-google-code-highlightjs */
/* Original theme - https://github.com/chriskempson/tomorrow-theme */

/* Tomorrow Comment */
.hljs-comment,
.hljs-quote {
	color: #8e908c;
}

/* Tomorrow Red */
.hljs-variable,
.hljs-template-variable,
.hljs-tag,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class,
.hljs-regexp,
.hljs-deletion {
	color: #c82829;
}

/* Tomorrow Orange */
.hljs-number,
.hljs-built_in,
.hljs-builtin-name,
.hljs-literal,
.hljs-type,
.hljs-params,
.hljs-meta,
.hljs-link {
	color: #f5871f;
}

/* Tomorrow Yellow */
.hljs-attribute {
	color: #eab700;
}

/* Tomorrow Green */
.hljs-string,
.hljs-symbol,
.hljs-bullet,
.hljs-addition {
	color: #718c00;
}

/* Tomorrow Blue */
.hljs-title,
.hljs-section {
	color: #4271ae;
}

/* Tomorrow Purple */
.hljs-keyword,
.hljs-selector-tag {
	color: #8959a8;
}

.hljs {
	display: block;
	overflow-x: auto;
	color: #4d4d4c;
	padding: 0.5em;
}

.hljs-emphasis {
	font-style: italic;
}

.hljs-strong {
	font-weight: bold;
}
</style>

<style>
/*
 * Markdown PDF CSS
 */

 body {
	font-family: -apple-system, BlinkMacSystemFont, "Segoe WPC", "Segoe UI", "Ubuntu", "Droid Sans", sans-serif, "Meiryo";
	padding: 0 12px;
}

pre {
	background-color: #f8f8f8;
	border: 1px solid #cccccc;
	border-radius: 3px;
	overflow-x: auto;
	white-space: pre-wrap;
	overflow-wrap: break-word;
}

pre:not(.hljs) {
	padding: 23px;
	line-height: 19px;
}

blockquote {
	background: rgba(127, 127, 127, 0.1);
	border-color: rgba(0, 122, 204, 0.5);
}

.emoji {
	height: 1.4em;
}

code {
	font-size: 14px;
	line-height: 19px;
}

/* for inline code */
:not(pre):not(.hljs) > code {
	color: #C9AE75; /* Change the old color so it seems less like an error */
	font-size: inherit;
}

/* Page Break : use <div class="page"/> to insert page break
-------------------------------------------------------- */
.page {
	page-break-after: always;
}

</style>

<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</head>
<body>
  <script>
    mermaid.initialize({
      startOnLoad: true,
      theme: document.body.classList.contains('vscode-dark') || document.body.classList.contains('vscode-high-contrast')
          ? 'dark'
          : 'default'
    });
  </script>
<h1 id="the-debbasejl-ecosystem-accessible-and-extensible-simulation-of-life-history-population-dynamics-and-stressor-effects-using-dynamic-energy-budgets">The DEBBase.jl ecosystem: accessible and extensible simulation of life-history, population dynamics and stressor effects using Dynamic Energy Budgets</h1>
<p>Simon Hansul, Andreas Focks</p>
<h2 id="context">Context</h2>
<p>Models based on Dynamic Energy Budget theory are gaining increasing attention in environmental sciences, especially in combination with Toxicokientic-Toxicodynamic (TKTD) models. DEB-TKTD models allow to extract information about the mechanisms of toxicity from life-history data, and to subsequently extrapolate the effects of chemical stressors from effects on the indivdual level to effects on population and community dynamics. As such, they are both valuable for basic scientific research and are of increasing interest for the application in environmental risk assessment. <br></p>
<h2 id="motivation">Motivation</h2>
<p>Several implementations of DEB and DEB-TKTD models exist.
However, there is need for a accessible yet flexible implementation
of DEB-TKTD models, which allows to efficiently simulate individual life-history
as well as population dynamics. Furthermore, models should be modifiable within a clear framework,  which should also enhance proper documentation of the modifications. The DEBBase.jl ecosystem aims to provide such an implementation. <br></p>
<h2 id="design-principles">Design principles</h2>
<p>DEBBase.jl is designed to be lean and modular.
That means, instead of providing as much functionality as possible in a single package,
DEBBase.jl only provides the definition of a base model, default parameters and DEBBase.simulators for the base model. Simulations are either be executed by passing the model on to an ODE solver,
or by passing them on to an individual-based simulation framework. This is a novel feature of DEBBase.jl compared to existing DEB-TKTD model implementations, since those focus either on simulating individual life-history (e.g. DEBtool, BYOM) or on simulating population dynamics (e.g. the Netlogo implementation by Martin et al. (2013)). <br></p>
<p>Parameter estimation is outsourced to the separate DEBABC.jl, but other Julia packages could be used to perform parameter estimation (e.g. Optim.jl). Vice versa, DEBABC.jl can also be used to perform parameter estimation for models which are not part of DEBBase.jl.
DEBBase.jl can be used as a dependency to implement more specific DEB models, as we will later demonstrate using a DEB model for amphibians.</p>
<h2 id="simulating-life-history">Simulating life-history</h2>
<p>With DEBBase.jl installed in the Julia environment, we can conduct a first simulation with just two lines of code:</p>
<pre class="hljs"><code><div><span class="hljs-keyword">using</span> DEBBase
simout = DEBBase.simulator(DEBParamCollection())
</div></code></pre>
<p>Here, the first line loads the DEBBase package. The second line calls the <code>DEBBase.simulator</code> function, which takes an object of type <code>DEBParamCollection</code> as argument.
This will assume a set of default parameters if no parameters are specified, as done above. <br>
The definition of <code>ParamCollections</code> in turn contains two fields:</p>
<ul>
<li><code>glb</code>: An instance of type <code>GlobalParams</code> which defines global parameters. These include quantities such as the timespan to simulate, nutrient input rates, and external chemical concentrations. The global parameters in combination define the environmental or experimental scenario to be simulated. The default values simulate life-history of the default DEB organism at <em>ad libitum</em> feeding conditions and without exposure to chemical stressors over a timespan of 21 days.</li>
<li><code>deb</code>: An instance of type <code>SpeciesParams</code>, which defines the DEB and TKTD parameters. The default organism roughly approximates the growth and reproduction of <em>Daphnia magna</em>.</li>
</ul>
<p>Figure 1 shows the growth and reproduction returned by the default parameter collection.</p>
<p><img src="../plots/basetest_growthrepo.png" alt="img"> <br>
<em>Figure 1: Structure $S$ and reproduction $R$ of the default organism in the default scenario.</em></p>
<p>The default parameters can be modified by specifying exactly the parameters which should be modified, e.g:</p>
<pre class="hljs"><code><div>p = DEBParamCollection()
p.deb.kappa = <span class="hljs-number">0.8</span>
simout = DEBBase.simulator(p)
</div></code></pre>
<p>This simulates the default parameters, except that the DEB parameter $\kappa$ (indicating the fraction of assimilated nutrients allocated to growth and somatic maintenance) is changed to 0.8 Alternatively, the following code achieves the same:</p>
<pre class="hljs"><code><div>simout = DEBBase.simulator(DEBParamCollection(deb = SpeciesParams(kappa = <span class="hljs-number">0.8</span>)))
</div></code></pre>
<p>The same applies to global parameters, e.g. to set the food input rate:</p>
<pre class="hljs"><code><div>simout = DEBBase.simulator(DEBParamCollection(glb = GlobalBaesParams(Xdot_in = <span class="hljs-number">800.</span>)))
</div></code></pre>
<h2 id="simulating-effects-of-chemical-stressors">Simulating effects of chemical stressors</h2>
<p>The TKTD component is implemented so that mixtures with an arbitrary number of mixture components can be simulated. For this reason, TKTD parameters are stored as Vectors, where each element of the Vector represents a mixture component. Furthermore, we assume that each mixture component can act via arbitrary combinations of Physiological Modes of Action (PMoA), represented by a separate parameter Vector for each PMoA. The PMoAs are indicated by the suffixes G = decrease in growth efficiency, M = increase in maintenance costs, A = decrease in assimilation efficiency, R = decrease in reproduction efficiency, h = lethal effects according to GUTS-RED-SD. <br></p>
<h3 id="tk-parameters">TK Parameters</h3>
<p>In the case of the TK parameters, each element of the Vector ` is a scalar value,
because we assume a simple TK model with a single parameter, the dominant rate constant $k_{D,z,j}$, specific for chemical stressor $z$ and PMoA $j$. The following would set the $k_{D,z,j}$-value for two stresors which both act via PMoA G:</p>
<pre class="hljs"><code><div>p = DEBParamCollection() <span class="hljs-comment"># instantiate default parameter </span>
p.deb.k_D_G = [<span class="hljs-number">0.1</span>, <span class="hljs-number">1.0</span>] <span class="hljs-comment"># modify TK parameters for PMoA G</span>
</div></code></pre>
<p>We can use <code>isolate_pmoas!</code> to ensure that all PMoAs which are not of interest are disenganged. This is achieved by setting the $k_{D,z,j}$-values for the disengaged PMoAs to 0.</p>
<pre class="hljs"><code><div>isolate_pmoas!(p, [<span class="hljs-string">"G"</span>]) <span class="hljs-comment"># make sure that all PMoAs expect G are disengaged</span>
</div></code></pre>
<h3 id="td-parameters">TD Parameters</h3>
<p>For the TD parameters, each element of the parameter Vector is a tuple, because we always need at least two dose-response parameters to model the effect of a stressor. By default, log-logistic relationships between the scaled damage $D_{z,j}$ and relative response $y_{z,j}$ are assumed. By conventions introduced in the DoseResponse.jl-package, the first parameter then indicates the sensitivity $e_{z,j}$ (equivalent to median effective damage for PMoAs G, A and R), whereas the second parameter corresponds to the slope $\beta_{z,j}$.
The following code sets the TD parameters for two stressors acting via PMoA G:</p>
<pre class="hljs"><code><div>p = DEBParamCollection() <span class="hljs-comment"># instantiate default parameter </span>
isolate_pmoas!(p, [<span class="hljs-string">"G"</span>]) <span class="hljs-comment"># disengage all PMoAs but G</span>
p.deb.drc_params_G = [
    (<span class="hljs-number">1.0</span>, <span class="hljs-number">2.0</span>), <span class="hljs-comment"># log-logistic parameters for stressor 1 with respect to PMoA G</span>
    (<span class="hljs-number">0.5</span>, <span class="hljs-number">3.0</span>) <span class="hljs-comment"># log-logistic parameters for stressor 2 with respect to PMoA G</span>
    ] 
</div></code></pre>
<h3 id="dose-response-functions">Dose-response functions</h3>
<p>By default, DEBBase.jl assumes a log-logistic relationship between the scaled damage $D_{z,j}$ and the relative response $y_{z,j}$. For PMoAs G, M and R, this is the well-known two-parameter log-logistic function:
$$
LL2(D_{z,j},\theta) = y_{z,j} = \frac{1}{1 + {\frac{D_{z,j}}{e_{z,j}}}^{\beta_{z,j}}} \
\ \
with \ j \in [G,A,R],\ \theta = (e_{z,j}, \beta_{z,j})
$$</p>
<p>For lethal effects, we need a monotonically increasing relationship between $D_{z,j}$ and the hazard rate $h_z$ with the origin at 0, which is given by the cumulative hazard function of the log-logistic distribution:
$$
LL2h(D_{z,h},\theta) = h_z = -ln \left( LL2D(D,\theta) \right) \
\ \
with\ \theta = (e_{z,h}, \beta_{z,h})
$$</p>
<p>For PMoA M, we need a monotonically increasing relationship with origin at 0, which we achieve by shifting $LL2h$:
$$
LL2M(D,\theta) = y_{z,M} 1 -ln \left( LL2D(D,\theta) \right) \
\ \
with\ \theta = (e_{z,M}, \beta_{z,M})
$$</p>
<p>We deviate here from previous DEB-TKTD implementations in two ways: We skip the &quot;stress&quot;-variable, because we consider this approach to be more transparent and easy to follow. Secondly, we replace the linear relationship between damage and stress with a log-logistic relationship (or one that is derived from it) due to practical and theoretical considerations (Hansul et al., 2023). <br>
However, the dose-response function for each stressor and PMoA is not hard-coded, but a parameter given in <code>SpeciesParams</code>.
Users can easily change the dose-response function by specification of the corresponding parameter:</p>
<pre class="hljs"><code><div>p = DEBParamCollection() <span class="hljs-comment"># instantiate default parameter </span>
isolate_pmoas!(p, [<span class="hljs-string">"G"</span>]) <span class="hljs-comment"># disengage all PMoAs but G</span>
p.deb.drc_functs_G = [
    LL2, <span class="hljs-comment"># use log-logistic relationship for stressor 1</span>
    NECneg <span class="hljs-comment"># use linear relationship with threshold (NEC) for tressor 2</span>
]
</div></code></pre>
<p>The general assumption for the dose response-function is that the returned value represents a relative response. I.e., to apply the effect of the stressor it can be multiplied with the corresponding term in the model without further transformations.
PMoA-specific transformations (as given above for PMoA M) are part of the definition of the dose response-function. <br>
Naturally, users also have to consider that the parameters given in <code>drc_params_G</code> are then also only valid for the dose response-function for which they have been determined. <br>
This way of implementing dose response-functions has the advantage that users can seemlessly switch between TKTD model flavours</p>
<h2 id="parameter-estimation-using-debabcjl">Parameter estimation using DEBABC.jl</h2>
<h2 id="simulating-population-dynamics">Simulating population dynamics</h2>
<h2 id="extending-the-base-model">Extending the base model</h2>
<h2 id="accessibility">Accessibility</h2>
<h2 id="outlook">Outlook</h2>
<ul>
<li>Environmental factors, e.g. temperature</li>
<li>Variable exposure concentrations</li>
<li>Mixtures: Damage addition, combinations of DA and IA, interaction factors</li>
<li>Sensitivity analysis</li>
</ul>

</body>
</html>
